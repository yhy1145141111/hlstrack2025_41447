# 大模型辅助使用记录

## 基本信息

- **模型名称**：GPT-5 Thinking
  
- **提供方 / 访问方式**：
  - 网址链接:https://chatgpt.com/
- **使用日期**：2025-10-21
- **项目名称**：SHA-256  算子优化

---

## 使用场景 1

### 主要用途
角色与总目标设定（限定任务边界与产出风格）

### 完整 Prompt 内容
```
从现在起你扮演资深 FPGA/HLS 工程师与代码改造助手。目标：把我随后提供的“sh 版 SHA-224/256 HLS 头文件”优化为“交1 风格（融合轮）”版本，保持接口与功能等价，提升时序（目标主循环 II=1）并优化资源映射。请使用中文回答；除非我要求解释，其余输出以可直接使用的代码与补丁为主。

```

### 模型输出摘要
明确自身“资深 HLS 工程师”的角色与写作约束。
统一任务目标：从 sh 升级到 交1（融合轮），接口等价、II=1、资源更优。
后续回答以可直接用的代码/补丁为主，解释最小化。
### 人工审核与采纳情况
认可该角色设定与输出风格

---

## 使用场景 2

### 主要用途
输入原文件（建立完整上下文）

### 完整 Prompt 内容
```
下面是头文件全文。请完整阅读后再开始改造，不要遗漏任一辅助类型/常量/pragma
```

### 模型输出摘要
读取并解析 sh 头文件的所有符号、类型、pragma 与数据流。

不产生改动，只建立后续改造所需的“地形图”。

### 人工审核与采纳情况
确认贴入了完整且最新的文件

---
## 使用场景 3

### 主要用途
迁移大纲与关键点（不输出代码）

### 完整 Prompt 内容
```
请先输出一份“迁移大纲”（10 行以内 bullets），内容包含：
- 会保留的函数/接口；
- 会删除/合并的旧函数（如 generateMsgSchedule / sha256Digest / dup_strm 等）；
- 将新增的融合轮函数名、签名与其职责；
- 关键 HLS pragma 与数据结构变化（流深度、资源绑定、依赖消解）；
- 潜在数据相关性与临界路径风险点（并给出规避思路）。
此段只给大纲，不要输出代码。

```

### 模型输出摘要
输出一页内的变更蓝图：保留/删除/新增结构、关键 pragma、依赖消解策略。
标注时序与布线风险点及规避手段（如 W 窗口、DSP/logic 划分、expression balance）。

### 人工审核与采纳情况
同意删除链路与新增接
风险与规避符合目标板与综合版本

---
## 使用场景 4

### 主要用途
实现“融合轮”函数（核心性能改造）

### 完整 Prompt 内容
```
现在开始实现“融合轮”函数。新增：
template<int h_width>
void sha256_rounds_fused(
  hls::stream<SHA256Block>& blk_strm,
  hls::stream<uint64_t>& nblk_strm,
  hls::stream<bool>& end_nblk_strm,
  hls::stream<ap_uint<h_width>>& hash_strm,
  hls::stream<bool>& end_hash_strm
);

实现细则（务必逐条满足）：
1) 把“消息调度 + 64 轮压缩”融合在一个 for (t=0..63) 循环里：
   - #pragma HLS PIPELINE II=1 rewind
   - 维护 16 项 W 的滑动窗；t>=16 时按 SSIG1(W[14]) + W[9] + SSIG0(W[1]) + W[0] 生成新 W，并窗口前移
   - #pragma HLS DEPENDENCE variable=W inter false
2) K[64]：
   - #pragma HLS array_partition variable=K complete
   - #pragma HLS RESOURCE variable=K core=ROM_1P
3) 算术结构：
   - 采用类似 CSA 的分解：将 {BSIG1(e), CH(e,f,g), K[t], W[t]} 的求和拆成 sum/carry 链
   - h + Wt 尽量绑定 DSP，其余加法走 fabric
   - 对 T1w/T2w 添加 #pragma HLS EXPRESSION_BALANCE
   - 对 a_next / e_next 声明 dependence inter false
4) 块末尾把工作寄存器累加回 H[0..7]，并保持 224/256 兼容（IV 与结果裁剪一致）
5) 正确驱动 end_hash_strm：非最后一条为 false，全部完成后推送 true
请先给出该函数的完整实现代码（可直接编译）。

```

### 模型输出摘要
产出可编译的 sha256_rounds_fused 函数：融合消息调度+压缩、II=1、窗口化 W、ROM_1P K 表。

精确定义 pragma 与 资源绑定（DSP/Fabric 划分、表达式平衡、依赖消解）。

正确处理 224/256 兼容 与终止标志流。

### 人工审核与采纳情况
本函数单独能过 C-sim 
关键pragma 与综合器版本兼容

---

## 使用场景 5

### 主要用途
调整顶层数据流（接口保持不变）

### 完整 Prompt 内容
```
请改造顶层（例如 sha256_top / sha224_256 顶层）：
- 保留 preProcessing(...) 以产生 blk_strm / nblk_strm / end_nblk_strm；
- 删除 generateMsgSchedule / sha256Digest / dup_strm 旧链路，改为直接调用 sha256_rounds_fused<h_width>(...);
- 为流设置合理深度与资源建议（示例：blk_strm depth≈64 绑定 FIFO_BRAM；nblk/end_nblk depth≈16 绑定 FIFO_SRL），写成 pragma；
- 不改变对外可见的模板参数、函数签名与 I/O 接口（224/256 分支保持一致）。
请输出完整改造后的顶层相关代码（可直接替换）。

```

### 模型输出摘要
给出顶层可替换实现：删旧链路、接入融合轮、补齐流深度/资源 pragma。

对外接口与行为保持等价，便于无缝集成。

### 人工审核与采纳情况
与现有测试无缝对接 
资源绑定（BRAM/SRL）满足目标器件配比

---
## 使用场景 6
### 主要用途
资源/时序目标与验收（交付可验证）

### 完整 Prompt 内容
```
请给出“资源与时序目标 + 验收清单”并据此微调 pragma：
- 目标：主 64 轮循环 II=1；关键路径不跨 DSP→fabric 的长链
- 资源：K→ROM_1P；blk→BRAM FIFO；nblk/end→SRL FIFO；W/H/K 适当 complete 分割
- 验收清单（请随代码一并提供）：
  1) 最小化补丁（diff/patch），便于我对比 sh→交1 的差异
  2) 关键 pragma 汇总表（逐条解释目的：时序/面积/布线）
  3) 自测与回归：给出小型 testbench/驱动示例，至少包含消息 “abc”、空串 对 SHA-256 与 SHA-224 的已知向量；说明如何喂入/读取流
  4) 风险与 TODO：列出可能受目标板/综合版本影响的点，以及若 II>1 时的优先级化优化手段
输出顺序：①完整新头文件 → ②diff/patch → ③pragma 表 → ④测试示例 → ⑤风险与 TODO。

```

### 模型输出摘要
交付完整新头文件、最小化 diff、pragma 目的表、可运行自测、风险与应对。

给出若 II>1 时的收敛步骤（减少组合深度、寄存器重定时、拆分表达式等）。

### 人工审核与采纳情况
通过 C-sim/CSYN/Vivado 合成的关键指标
自测哈希与已知向量 bit-true

---
## 使用场景 7

### 主要用途
风格统一与可读性收尾（便于维护）

### 完整 Prompt 内容
```
最后一步，请统一代码风格（命名、注释、段落顺序），为新增函数与顶层新增/变更处补充行内注释（聚焦数据依赖/资源绑定/时序原因），并在文件头添加“改造摘要”（5~8 行），便于后续维护。

```

### 模型输出摘要
统一命名/注释与段落结构；在关键处补时序原因说明。

文件头新增 5~8 行“改造摘要”，概括动机→手段→收益。
### 人工审核与采纳情况
符合团队编码规范

---
## 使用场景 8

### 主要用途
符号或类型差异的兼容处理

### 完整 Prompt 内容
```
如遇到符号名、类型别名或常量定义与原文件不一致的情况，请“就地统一”，但务必在 diff 里显式标注改名映射；严禁引入影响外部接口兼容性的宏与 typedef 变更。

```

### 模型输出摘要
维持外部接口不变前提下统一内部命名/类型。

在 diff 中提供改名映射表，避免评审遗漏。

### 人工审核与采纳情况
无潜在 ABI/接口兼容性风险

---

## 总结

### 整体贡献度评估
        大模型贡献占比：约 65%

                方案设计与代码生成：≈ 50%（融合轮实现、pragma 策略、顶层改造）

                文档与测试资产：≈ 15%（diff、pragma 表、用例与说明）

        人工介入与修正占比：约 35%

                代码校对与工程集成：≈ 20%

                综合/P&R 收敛与参数回调：≈ 10%

                板级联调与结果确认：≈ 5%

          主要帮助领域：代码优化 / 文档撰写 / 调试分析

### 学习收获
融合设计思路：把消息调度与压缩合并在单循环里，通过 16-word W 滑动窗 消解跨迭代依赖。

            关键 HLS 技巧：

            #pragma HLS PIPELINE II=1 rewind、DEPENDENCE variable=W inter false

            array_partition ... complete（W/H/K）与 RESOURCE ... core=ROM_1P（K 常量表）

            EXPRESSION_BALANCE、DSP 与 Fabric 加法链的有意识分工

            流深度与资源绑定（BRAM/SRL）对吞吐与布线的影响

时序优化套路：缩短 T1/T2 组合路径、窗口化数据、必要处增加寄存器/分段求和。

工程化实践：以最小化diff交付、配套回归向量与pragma目的表，便于评审和持续收敛。

Prompt工程：拆段驱动式指令（角色→大纲→实现→验收）显著降低偏航与返工率，便于在新对话中复用与追踪。

---

## 附注

- 请确保填写真实、完整的使用记录
- 如未使用大模型辅助，请在此文件中注明"本项目未使用大模型辅助"
- 评审方将参考此记录了解项目的独立性与创新性
